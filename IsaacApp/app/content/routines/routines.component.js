"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var routines_service_1 = require("./routines.service");
var RoutinesComponent = /** @class */ (function () {
    function RoutinesComponent(routinesService, routerExtensions) {
        this.routinesService = routinesService;
        this.routerExtensions = routerExtensions;
        this.refresh();
    }
    RoutinesComponent.prototype.refresh = function () {
        var _this = this;
        console.info("refreshing routines");
        this.routines = [];
        this.connectionError = false;
        this.loadMask = false;
        this.routinesService.getRoutines().subscribe(function (r) {
            if (r == undefined) {
                _this.connectionError = true;
            }
            else {
                //console.log(r);
                _this.routines = r;
                _this.formatRoutines();
                _this.connectionError = false;
            }
            _this.loadMask = false;
        });
    };
    RoutinesComponent.prototype.formatRoutines = function () {
        for (var _i = 0, _a = this.routines; _i < _a.length; _i++) {
            var r = _a[_i];
            if (r.recurring) {
                var dis = "";
                var week = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
                for (var i = 0; i < 7; i++) {
                    if (r.days[i]) {
                        dis += (week[i] + ", ");
                    }
                }
                dis = dis.slice(0, -2);
                r.displayDate = dis;
            }
            else {
                var options = { year: '2-digit', month: 'short', day: 'numeric' };
                r.displayDate = new Date(r.date.year, r.date.month - 1, r.date.day).toLocaleDateString('en-US', options);
            }
            var t = new Date(0, 0, 0, r.time.hour, r.time.minute, 0);
            var displayTime = t.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }).split(' ')[0];
            var split = displayTime.split(":");
            r.displayTime = split[0] + ":" + split[1];
        }
    };
    RoutinesComponent.prototype.deleteRoutine = function (routine) {
        this.routinesService.deleteRoutine(routine._id.$oid).subscribe(function (r) {
            console.log(r);
            //TODO in case of error refresh and show message
        });
        var index = 0;
        for (var i = 0; i < this.routines.length; i++) {
            if (this.routines[i]._id.$oid === routine._id.$oid) {
                index = i;
                break;
            }
        }
        this.routines.splice(index, 1);
    };
    RoutinesComponent.prototype.editRoutine = function (routine) {
        this.routerExtensions.navigate(["/routines", routine._id.$oid], {
            transition: {
                name: "fade",
                duration: 500,
                curve: "easeIn"
            }
        });
    };
    RoutinesComponent.prototype.addRoutine = function () {
        console.log("settings button pushed");
        this.routerExtensions.navigate(["/routines", ""], {
            transition: {
                name: "fade",
                duration: 500,
                curve: "easeIn"
            }
        });
    };
    RoutinesComponent = __decorate([
        core_1.Component({
            selector: "routines",
            templateUrl: "./content/routines/routines.component.html"
        }),
        __metadata("design:paramtypes", [routines_service_1.RoutinesService,
            router_1.RouterExtensions])
    ], RoutinesComponent);
    return RoutinesComponent;
}());
exports.RoutinesComponent = RoutinesComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGluZXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91dGluZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTBDO0FBQzFDLHNEQUErRDtBQUMvRCx1REFBcUQ7QUFNckQ7SUFPSSwyQkFDWSxlQUFnQyxFQUNoQyxnQkFBa0M7UUFEbEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDMUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxtQ0FBTyxHQUFQO1FBQUEsaUJBZ0JDO1FBZkEsT0FBTyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQUEsQ0FBQztZQUMxQyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDaEIsS0FBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7WUFDaEMsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLGlCQUFpQjtnQkFDakIsS0FBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7Z0JBQ2xCLEtBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdEIsS0FBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7WUFDakMsQ0FBQztZQUNELEtBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELDBDQUFjLEdBQWQ7UUFDSSxHQUFHLENBQUEsQ0FBVSxVQUFhLEVBQWIsS0FB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QUcsQ0FBQyxDQUFDO2dCQUNWLEtBQUssQ0FBQztZQUNWLENBQUM7UUFDTCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFRCx1Q0FBVyxHQUFYLFVBQVksT0FBWTtRQUNwQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDNUQsVUFBVSxFQUFFO2dCQUNSLElBQUksRUFBRSxNQUFNO2dCQUNaLFFBQVEsRUFBRSxHQUFHO2dCQUNiLEtBQUssRUFBRSxRQUFRO2FBQ2xCO1NBQ0osQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELHNDQUFVLEdBQVY7UUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsRUFBRTtZQUM5QyxVQUFVLEVBQUU7Z0JBQ1IsSUFBSSxFQUFFLE1BQU07Z0JBQ1osUUFBUSxFQUFFLEdBQUc7Z0JBQ2IsS0FBSyxFQUFFLFFBQVE7YUFDbEI7U0FDSixDQUFDLENBQUM7SUFDUCxDQUFDO0lBM0ZRLGlCQUFpQjtRQUo3QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFVBQVU7WUFDcEIsV0FBVyxFQUFFLDRDQUE0QztTQUM1RCxDQUFDO3lDQVMrQixrQ0FBZTtZQUNkLHlCQUFnQjtPQVRyQyxpQkFBaUIsQ0E2RjdCO0lBQUQsd0JBQUM7Q0FBQSxBQTdGRCxJQTZGQztBQTdGWSw4Q0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IFJvdXRpbmVzU2VydmljZSB9IGZyb20gXCIuL3JvdXRpbmVzLnNlcnZpY2VcIjtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwicm91dGluZXNcIixcbiAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRlbnQvcm91dGluZXMvcm91dGluZXMuY29tcG9uZW50Lmh0bWxcIlxufSlcbmV4cG9ydCBjbGFzcyBSb3V0aW5lc0NvbXBvbmVudCB7XG5cblx0Ly9UT0RPIGhlcmUgcmVmcmVzaCBvbmx5IG9uIHJlZnJlc2ggYnV0dG9uIHByZXNzLCBuYXZpZ2F0aW9uIGFuZCBvbiBvcGVuaW5nLCBhbmQgb24gbmV3IGFkZC4gbm8gaW50ZXJ2YWxzIG5lZWRlZCBcblx0cHJpdmF0ZSBjb25uZWN0aW9uRXJyb3I7XG5cdHByaXZhdGUgcm91dGluZXM7XG5cdHByaXZhdGUgbG9hZE1hc2s7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0aW5lc1NlcnZpY2U6IFJvdXRpbmVzU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXJFeHRlbnNpb25zOiBSb3V0ZXJFeHRlbnNpb25zKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHJlZnJlc2goKSB7XG4gICAgXHRjb25zb2xlLmluZm8oXCJyZWZyZXNoaW5nIHJvdXRpbmVzXCIpO1xuICAgICAgICB0aGlzLnJvdXRpbmVzID0gW107XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbkVycm9yID0gZmFsc2U7XG4gICAgXHR0aGlzLmxvYWRNYXNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMucm91dGluZXNTZXJ2aWNlLmdldFJvdXRpbmVzKCkuc3Vic2NyaWJlKHI9PntcbiAgICAgICAgICAgIGlmKHIgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHIpO1xuICAgICAgICAgICAgICAgIHRoaXMucm91dGluZXMgPSByO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0Um91dGluZXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25FcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sb2FkTWFzayA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmb3JtYXRSb3V0aW5lcygpIHtcbiAgICAgICAgZm9yKGxldCByIG9mIHRoaXMucm91dGluZXMpIHtcbiAgICAgICAgICAgIGlmKHIucmVjdXJyaW5nKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRpcyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgbGV0IHdlZWsgPSBbXCJNb25cIiwgXCJUdWVcIiwgXCJXZWRcIiwgXCJUaHVcIiwgXCJGcmlcIiwgXCJTYXRcIiwgXCJTdW5cIl1cbiAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTw3OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoci5kYXlzW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXMgKz0gKHdlZWtbaV0rXCIsIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkaXMgPSBkaXMuc2xpY2UoMCwgLTIpO1xuICAgICAgICAgICAgICAgIHIuZGlzcGxheURhdGUgPSBkaXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0geyB5ZWFyOiAnMi1kaWdpdCcsIG1vbnRoOiAnc2hvcnQnLCBkYXk6ICdudW1lcmljJyB9O1xuICAgICAgICAgICAgICAgIHIuZGlzcGxheURhdGUgPSBuZXcgRGF0ZShyLmRhdGUueWVhciwgci5kYXRlLm1vbnRoLTEsIHIuZGF0ZS5kYXkpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHQgPSBuZXcgRGF0ZSgwLDAsMCwgci50aW1lLmhvdXIsIHIudGltZS5taW51dGUsIDApO1xuICAgICAgICAgICAgbGV0IGRpc3BsYXlUaW1lID0gdC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHtob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTonMi1kaWdpdCd9KS5zcGxpdCgnICcpWzBdO1xuICAgICAgICAgICAgbGV0IHNwbGl0ID0gZGlzcGxheVRpbWUuc3BsaXQoXCI6XCIpO1xuICAgICAgICAgICAgci5kaXNwbGF5VGltZSA9IHNwbGl0WzBdK1wiOlwiK3NwbGl0WzFdO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZWxldGVSb3V0aW5lKHJvdXRpbmU6IGFueSkge1xuICAgICAgICB0aGlzLnJvdXRpbmVzU2VydmljZS5kZWxldGVSb3V0aW5lKHJvdXRpbmUuX2lkLiRvaWQpLnN1YnNjcmliZShyID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHIpO1xuICAgICAgICAgICAgLy9UT0RPIGluIGNhc2Ugb2YgZXJyb3IgcmVmcmVzaCBhbmQgc2hvdyBtZXNzYWdlXG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBpbmRleCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yb3V0aW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYodGhpcy5yb3V0aW5lc1tpXS5faWQuJG9pZCA9PT0gcm91dGluZS5faWQuJG9pZCkge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJvdXRpbmVzLnNwbGljZShpbmRleCwxKTtcbiAgICB9XG5cbiAgICBlZGl0Um91dGluZShyb3V0aW5lOiBhbnkpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9yb3V0aW5lc1wiLCByb3V0aW5lLl9pZC4kb2lkXSwge1xuICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiZmFkZVwiLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICAgICAgICAgICAgY3VydmU6IFwiZWFzZUluXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7IFxuICAgIH1cblxuICAgIGFkZFJvdXRpbmUoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic2V0dGluZ3MgYnV0dG9uIHB1c2hlZFwiKTtcbiAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9yb3V0aW5lc1wiLCBcIlwiXSwge1xuICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiZmFkZVwiLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICAgICAgICAgICAgY3VydmU6IFwiZWFzZUluXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG59Il19